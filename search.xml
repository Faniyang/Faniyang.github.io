<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Layer2 —— Blockscout 部署指南</title>
      <link href="/2025/09/17/blockscout-deployment-part2/"/>
      <url>/2025/09/17/blockscout-deployment-part2/</url>
      
        <content type="html"><![CDATA[<h2 id="一、系统环境准备"><a href="#一、系统环境准备" class="headerlink" title="一、系统环境准备"></a>一、系统环境准备</h2><h3 id="1-1-安装软件依赖"><a href="#1-1-安装软件依赖" class="headerlink" title="1.1 安装软件依赖"></a>1.1 安装软件依赖</h3><p>打开 Ubuntu-24.04 子系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新系统</span></span><br><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基础工具</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y curl wget git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译工具 / 构建</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y build-essential make g++ gcc automake libtool cmake</span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统库</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y libudev-dev libgmp-dev libgmp10 libssl-dev libncurses-dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩 / 解压</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y zip unzip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监控工具</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y inotify-tools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 asdf</span></span><br><span class="line">go install github.com/asdf-vm/asdf/cmd/asdf@v0.18.0</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PATH=&quot;$HOME/go/bin:$PATH&quot;&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 postgreSQL-17 数据库</span></span><br><span class="line">curl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc|<span class="built_in">sudo</span> gpg --dearmor -o /etc/apt/trusted.gpg.d/postgresql.gpg</span><br><span class="line"><span class="built_in">sudo</span> sh -c <span class="string">&#x27;echo &quot;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&quot; &gt; /etc/apt/sources.list.d/pgdg.list&#x27;</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install postgresql-17</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 rust</span></span><br><span class="line">curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 docker-compose</span></span><br><span class="line"><span class="built_in">sudo</span> apt install docker-compose</span><br></pre></td></tr></table></figure><h3 id="1-2-配置-asdf"><a href="#1-2-配置-asdf" class="headerlink" title="1.2 配置 asdf"></a>1.2 配置 asdf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 Erlang、Elixir、Node.js 插件</span></span><br><span class="line">asdf plugin add erlang</span><br><span class="line">asdf plugin add elixir</span><br><span class="line">asdf plugin add nodejs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于 blockscout backend</span></span><br><span class="line">asdf install erlang 27.3.4</span><br><span class="line">asdf install elixir 1.17.3-otp-27</span><br><span class="line">asdf install nodejs 20.17.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于 blockscout frontend</span></span><br><span class="line">asdf install nodejs 22.11.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载 asdf 环境变量</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$HOME</span>/.asdf/shims:<span class="variable">$HOME</span>/.asdf/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h3 id="1-3-配置-Postgres-数据库"><a href="#1-3-配置-Postgres-数据库" class="headerlink" title="1.3 配置 Postgres 数据库"></a>1.3 配置 Postgres 数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换数据库管理员</span></span><br><span class="line">su - postgres <span class="comment"># for Root</span></span><br><span class="line"><span class="built_in">sudo</span> -i -u postgres <span class="comment"># for user</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据库用户</span></span><br><span class="line">createuser --interactive</span><br><span class="line"><span class="comment"># 输入角色名: YOUR_DBUSER_NAME</span></span><br><span class="line"><span class="comment"># 是否为超级用户? (y/n) y</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据库</span></span><br><span class="line">createdb blockscout</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改用户密码</span></span><br><span class="line">psql</span><br><span class="line">ALTER USER YOUR_DBUSER_NAME WITH PASSWORD <span class="string">&#x27;YourSecurePassword&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON DATABASE blockscout TO YOUR_DBUSER_NAME;</span><br><span class="line">\q</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart postgresql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查数据库设置是否成功</span></span><br><span class="line">su - YOUR_DBUSER_NAME <span class="comment"># for Root</span></span><br><span class="line"><span class="built_in">sudo</span> su - YOUR_DBUSER_NAME <span class="comment"># for user</span></span><br><span class="line">psql -d blockscout<span class="comment"># 如果能看到 blockscout=# 说明成功</span></span><br><span class="line">\q</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 psql 运行状态</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl status postgresql</span><br></pre></td></tr></table></figure><h2 id="二、构建-Blockscout-Backend"><a href="#二、构建-Blockscout-Backend" class="headerlink" title="二、构建 Blockscout Backend"></a>二、构建 Blockscout Backend</h2><h3 id="2-1-克隆-Blockscout-Backend-仓库"><a href="#2-1-克隆-Blockscout-Backend-仓库" class="headerlink" title="2.1 克隆 Blockscout Backend 仓库"></a>2.1 克隆 Blockscout Backend 仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 blockscout 工作目录</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">mkdir</span> -p blockscout</span><br><span class="line"><span class="built_in">cd</span> blockscout</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆 blockscout backend 并切换到最新 release 分支</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/blockscout/blockscout.git backend</span><br><span class="line"><span class="built_in">cd</span> backend</span><br><span class="line">git checkout v9.1.0 -b v9.1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 Mix 依赖并编译</span></span><br><span class="line">mix <span class="keyword">do</span> deps.get, local.rebar --force, deps.compile, compile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为数据库生成新的 secret_key_base</span></span><br><span class="line">mix phx.gen.secret</span><br></pre></td></tr></table></figure><h3 id="2-2-编辑环境变量文件"><a href="#2-2-编辑环境变量文件" class="headerlink" title="2.2 编辑环境变量文件"></a>2.2 编辑环境变量文件</h3><p>创建 <code>env_vars.env</code> 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano env_vars.env</span><br></pre></td></tr></table></figure><p>填写以下变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DATABASE_URL=postgresql://YOUR_DBUSER_NAME:YourSecurePassword@localhost:5432/blockscout</span><br><span class="line"><span class="built_in">export</span> SECRET_KEY_BASE= <span class="comment"># generated by mix phx.gen.secret</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> ETHEREUM_JSONRPC_VARIANT=geth</span><br><span class="line"><span class="built_in">export</span> ETHEREUM_JSONRPC_HTTP_URL=http://localhost:8545</span><br><span class="line"><span class="built_in">export</span> ETHEREUM_JSONRPC_WS_URL=ws://localhost:8546</span><br><span class="line"><span class="built_in">export</span> ETHEREUM_JSONRPC_TRACE_URL=http://localhost:8545</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> API_V2_ENABLED=<span class="literal">true</span></span><br><span class="line"><span class="built_in">export</span> PORT=4000</span><br><span class="line"><span class="built_in">export</span> MIX_ENV=prod</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CHAIN_ID=L2_CHAIN_ID</span><br><span class="line"><span class="built_in">export</span> L1_RPC=L1_RPC_URL</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> COIN=ETH</span><br><span class="line"><span class="built_in">export</span> COIN_NAME=<span class="string">&quot;Sepolia ETH&quot;</span></span><br><span class="line"><span class="built_in">export</span> COINGECKO_COIN_ID=ethereum</span><br><span class="line"><span class="built_in">export</span> DISPLAY_TOKEN_ICONS=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> MICROSERVICE_SC_VERIFIER_ENABLED=<span class="literal">true</span></span><br><span class="line"><span class="built_in">export</span> MICROSERVICE_SC_VERIFIER_URL=http://localhost:8082/</span><br><span class="line"><span class="built_in">export</span> MICROSERVICE_VISUALIZE_SOL2UML_ENABLED=<span class="literal">true</span></span><br><span class="line"><span class="built_in">export</span> MICROSERVICE_VISUALIZE_SOL2UML_URL=http://localhost:8081/</span><br><span class="line"><span class="built_in">export</span> MICROSERVICE_SIG_PROVIDER_ENABLED=<span class="literal">true</span></span><br><span class="line"><span class="built_in">export</span> MICROSERVICE_SIG_PROVIDER_URL=http://localhost:8083/</span><br></pre></td></tr></table></figure><p>加载环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> env_vars.env</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 postgresql 运行状态</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl status postgresql</span><br><span class="line"><span class="comment"># 创建数据库并迁移</span></span><br><span class="line">mix <span class="keyword">do</span> ecto.create, ecto.migrate</span><br></pre></td></tr></table></figure><h3 id="2-3-安装-Blockscout-Backend-内置前端静态资源"><a href="#2-3-安装-Blockscout-Backend-内置前端静态资源" class="headerlink" title="2.3 安装 Blockscout Backend 内置前端静态资源"></a>2.3 安装 Blockscout Backend 内置前端静态资源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 Node.js 依赖</span></span><br><span class="line"><span class="built_in">cd</span> apps/block_scout_web/assets</span><br><span class="line">npm install</span><br><span class="line">node_modules/webpack/bin/webpack.js --mode production</span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line"><span class="built_in">cd</span> apps/explorer</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译静态资源</span></span><br><span class="line"><span class="built_in">cd</span> ../block_scout_web/</span><br><span class="line">mix phx.digest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成自签名证书以启用 HTTPS（开发环境）：</span></span><br><span class="line">mix phx.gen.cert blockscout blockscout.local</span><br><span class="line"><span class="built_in">cd</span> ../..</span><br></pre></td></tr></table></figure><p>将 <code>blockscout</code> 和 <code>blockscout.local</code> 添加到 <code>/etc/hosts</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/hosts</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加以下行</span></span><br><span class="line">127.0.0.1 localhost blockscout blockscout.local</span><br><span class="line">::1 localhost blockscout blockscout.local</span><br><span class="line"></span><br><span class="line"> <span class="built_in">sudo</span> nano /etc/postgresql/17/main/pg_hba.conf</span><br><span class="line">host    all             all            0.0.0.0/0               scram-sha-256</span><br></pre></td></tr></table></figure><h2 id="三、运行微服务"><a href="#三、运行微服务" class="headerlink" title="三、运行微服务"></a>三、运行微服务</h2><h3 id="3-1-修改-stats-yml"><a href="#3-1-修改-stats-yml" class="headerlink" title="3.1 修改 stats.yml"></a>3.1 修改 stats.yml</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> docker-compose/services</span><br><span class="line">nano stats.yml</span><br></pre></td></tr></table></figure><p>将 <code>stats.yml</code> 文件的第 <strong>49</strong> 行改为自己的 <code>postgresql</code> 数据库，将 localhost 改为本机 IP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#STATS__BLOCKSCOUT_DB_URL=$&#123;STATS__BLOCKSCOUT_DB_URL:postgresql://blockscout:ceWb1MeLBEeOIfk65gU8EjF8@db:5432/blockscout&#125;</span></span><br><span class="line"></span><br><span class="line">STATS__BLOCKSCOUT_DB_URL=<span class="variable">$&#123;STATS__BLOCKSCOUT_DB_URL:postgresql://YOUR_DBUSER_NAME:YourSecurePassword@YourIPADDR:5432/blockscout&#125;</span></span><br></pre></td></tr></table></figure><h3 id="3-2-修改-user-ops-indexer-yml"><a href="#3-2-修改-user-ops-indexer-yml" class="headerlink" title="3.2 修改 user-ops-indexer.yml"></a>3.2 修改 user-ops-indexer.yml</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano user-ops-indexer.yml</span><br></pre></td></tr></table></figure><p>修改 <code>user-ops-indexer.yml</code> 文件的第 <strong>15</strong> 和 <strong>16</strong> 行，替换自己的 <code>postgresql</code> 数据库和本机 IP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># USER_OPS_INDEXER__INDEXER__RPC_URL=$&#123;USER_OPS_INDEXER__INDEXER__RPC_URL:ws://host.docker.internal:8545/&#125;</span></span><br><span class="line"><span class="comment"># USER_OPS_INDEXER__DATABASE__CONNECT__URL=$&#123;USER_OPS_INDEXER__DATABASE__CONNECT__URL:postgresql://blockscout:ceWb1MeLBEeOIfk65gU8EjF8@db:5432/blockscout&#125;</span></span><br><span class="line"></span><br><span class="line">USER_OPS_INDEXER__INDEXER__RPC_URL=<span class="variable">$&#123;USER_OPS_INDEXER__INDEXER__RPC_URL:-ws://YourIPADDR:8546/&#125;</span></span><br><span class="line">STATS__BLOCKSCOUT_DB_URL=<span class="variable">$&#123;STATS__BLOCKSCOUT_DB_URL:postgresql://YOUR_DBUSER_NAME:YourSecurePassword@YourIPADDR:5432/blockscout&#125;</span></span><br></pre></td></tr></table></figure><h3 id="3-3-删除-explorer-conf-template"><a href="#3-3-删除-explorer-conf-template" class="headerlink" title="3.3 删除 explorer.conf.template"></a>3.3 删除 explorer.conf.template</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ../proxy</span><br><span class="line"><span class="built_in">mv</span> explorer.conf.template explorer.conf.template.backup</span><br></pre></td></tr></table></figure><h3 id="3-4-修改-common-stats-yml"><a href="#3-4-修改-common-stats-yml" class="headerlink" title="3.4 修改 common-stats.yml"></a>3.4 修改 common-stats.yml</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ../envs</span><br><span class="line">nano common-stats.env</span><br></pre></td></tr></table></figure><p>将 <code>common-stats.yml</code> 的第 <strong>29</strong> 行修改为自己的后端服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># STATS__BLOCKSCOUT_API_URL=http://host.docker.internal</span></span><br><span class="line">STATS__BLOCKSCOUT_API_URL=http://YourIPADDR:4000</span><br></pre></td></tr></table></figure><h3 id="3-5-启动内置微服务"><a href="#3-5-启动内置微服务" class="headerlink" title="3.5 启动内置微服务"></a>3.5 启动内置微服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">docker-compose -f microservices.yml up -d</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure><p>此时如果 <code>layer2</code> 是启动状态，所有微服务都应该启动成功，如果失败查看 logs <code>docker logs ServiceName</code></p><p><img src="/images/2025/microservice.png" alt="microservice"></p><h3 id="3-6-启动后端服务"><a href="#3-6-启动后端服务" class="headerlink" title="3.6 启动后端服务"></a>3.6 启动后端服务</h3><p>返回 <code>blockscout-backend</code> 根目录并启动 Phoenix 服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/blockscout/backend/</span><br><span class="line">mix phx.server</span><br></pre></td></tr></table></figure><p>后端应运行在 <code>http://localhost:4000</code>（或配置的域名）</p><p><img src="/images/2025/backend.png" alt="backend"></p><h2 id="四、构建-Blockscout-Frontend"><a href="#四、构建-Blockscout-Frontend" class="headerlink" title="四、构建 Blockscout Frontend"></a>四、构建 Blockscout Frontend</h2><h3 id="4-1-克隆-Blockscout-Frontend-仓库"><a href="#4-1-克隆-Blockscout-Frontend-仓库" class="headerlink" title="4.1 克隆 Blockscout Frontend 仓库"></a>4.1 克隆 Blockscout Frontend 仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 克隆 blockscout frontend 并切换到最新 release 分支</span></span><br><span class="line"><span class="built_in">cd</span> ~/blockscout</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/blockscout/frontend.git frontend</span><br><span class="line"><span class="built_in">cd</span> frontend</span><br><span class="line">git checkout v2.3.2 -b v2.3.2</span><br></pre></td></tr></table></figure><p>在 <code>frontend</code> 目录下新建 <code>.tool-versions</code> 文件并写入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nodejs 22.11.0</span><br></pre></td></tr></table></figure><h3 id="4-2-在-configs-envs-与根目录下分别创建-env-namepreset-和-env-文件"><a href="#4-2-在-configs-envs-与根目录下分别创建-env-namepreset-和-env-文件" class="headerlink" title="4.2 在 configs&#x2F;envs 与根目录下分别创建 .env.namepreset 和 .env 文件"></a>4.2 在 configs&#x2F;envs 与根目录下分别创建 .env.namepreset 和 .env 文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用基础配置</span></span><br><span class="line">NEXT_PUBLIC_APP_HOST=localhost</span><br><span class="line">NEXT_PUBLIC_APP_PORT=3000</span><br><span class="line">NEXT_PUBLIC_APP_INSTANCE=localhost</span><br><span class="line">NEXT_PUBLIC_APP_ENV=development</span><br><span class="line"></span><br><span class="line">NEXT_PUBLIC_API_HOST=localhost</span><br><span class="line">NEXT_PUBLIC_API_PORT=4000</span><br><span class="line">NEXT_PUBLIC_API_PROTOCOL=http</span><br><span class="line">NEXT_PUBLIC_API_WEBSOCKET_PROTOCOL=<span class="string">&#x27;ws&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 微服务配置</span></span><br><span class="line">NEXT_PUBLIC_STATS_API_HOST=http://localhost:8080</span><br><span class="line">NEXT_PUBLIC_VISUALIZE_API_HOST=http://localhost:8081</span><br><span class="line"></span><br><span class="line"><span class="comment"># 首页内容配置</span></span><br><span class="line">NEXT_PUBLIC_HOMEPAGE_CHARTS=[<span class="string">&#x27;daily_txs&#x27;</span>, <span class="string">&#x27;coin_price&#x27;</span>, <span class="string">&#x27;market_cap&#x27;</span>]</span><br><span class="line">NEXT_PUBLIC_HOMEPAGE_HERO_BANNER_CONFIG=&#123;<span class="string">&quot;background&quot;</span>:[<span class="string">&quot;rgba(27, 74, 221, 1)&quot;</span>]&#125;</span><br><span class="line">NEXT_PUBLIC_HOMEPAGE_STATS=[<span class="string">&#x27;total_blocks&#x27;</span>,<span class="string">&#x27;average_block_time&#x27;</span>,<span class="string">&#x27;total_txs&#x27;</span>,<span class="string">&#x27;wallet_addresses&#x27;</span>,<span class="string">&#x27;gas_tracker&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 广告配置</span></span><br><span class="line">NEXT_PUBLIC_AD_BANNER_PROVIDER=none</span><br><span class="line">NEXT_PUBLIC_AD_TEXT_PROVIDER=none</span><br><span class="line"></span><br><span class="line"><span class="comment"># 区块链网络配置</span></span><br><span class="line">NEXT_PUBLIC_NETWORK_NAME=<span class="string">&quot;YangFan&quot;</span></span><br><span class="line">NEXT_PUBLIC_NETWORK_ID=L2_CHAIN_ID</span><br><span class="line">NEXT_PUBLIC_NETWORK_CURRENCY_NAME=<span class="string">&quot;Sepolia ETH&quot;</span></span><br><span class="line">NEXT_PUBLIC_NETWORK_CURRENCY_SYMBOL=<span class="string">&quot;ETH&quot;</span></span><br><span class="line">NEXT_PUBLIC_NETWORK_CURRENCY_DECIMALS=18</span><br></pre></td></tr></table></figure><h3 id="4-3-启动前端服务"><a href="#4-3-启动前端服务" class="headerlink" title="4.3 启动前端服务"></a>4.3 启动前端服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装项目依赖并启动前端调试</span></span><br><span class="line">yarn install</span><br><span class="line">yarn dev:preset namepreset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调试完成后启动服务</span></span><br><span class="line">yarn build</span><br><span class="line">yarn start</span><br></pre></td></tr></table></figure><p>后端应运行在 <code>http://localhost:3000</code>（或配置的域名）</p><p><img src="/images/2025/frontend.png" alt="frontend"></p><p><strong>Hooray！Blockscout 部署成功！</strong></p><h2 id="五、故障排查"><a href="#五、故障排查" class="headerlink" title="五、故障排查"></a>五、故障排查</h2><h3 id="5-1-数据库最大连接数限制"><a href="#5-1-数据库最大连接数限制" class="headerlink" title="5.1 数据库最大连接数限制"></a>5.1 数据库最大连接数限制</h3><p><code>PostgreSQL</code> 的默认最大连接数（max_connections）通常为 <strong>100</strong>，Blockscout 后端和多个微服务会创建大量数据库连接，占用了所有可用连接槽。此时会遇到：<code>FATAL: sorry, too many clients already</code> 之类的错误，此时需要修改数据库默认最大连接数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/postgresql/*/main/postgresql.conf</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max_connections = 500</span><br></pre></td></tr></table></figure><p>更改后需要重启 <code>PostgreSQL</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart postgresql</span><br></pre></td></tr></table></figure><h3 id="5-2-JavaScript-heap-out-of-memory"><a href="#5-2-JavaScript-heap-out-of-memory" class="headerlink" title="5.2 JavaScript heap out of memory"></a>5.2 JavaScript heap out of memory</h3><p><code>yarn build</code> 时可能会遇到 <code>JavaScript</code> 内存溢出，此时需要加载环境变量 <code>NODE_OPTIONS</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> NODE_OPTIONS=<span class="string">&quot;--max-old-space-size=4096&quot;</span></span><br></pre></td></tr></table></figure><h3 id="5-3-后端连接数据库失败"><a href="#5-3-后端连接数据库失败" class="headerlink" title="5.3 后端连接数据库失败"></a>5.3 后端连接数据库失败</h3><p>在用户名和密码都正确的前提下数据库连接失败，可能时因为 <code>PostgreSQL</code> 数据库的认证配置限制了密码认证方式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/postgresql/17/main/pg_hba.conf</span><br></pre></td></tr></table></figure><p>在 <code># IPv4 local connections:</code>下添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host    all             all             0.0.0.0/0               scram-sha-256</span><br></pre></td></tr></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li>Blockscout 官方文档: <a href="https://docs.blockscout.com/setup/deployment/manual-deployment-guide">https://docs.blockscout.com/setup/deployment/manual-deployment-guide</a></li><li>前端仓库: <a href="https://github.com/blockscout/frontend">https://github.com/blockscout/frontend</a></li><li>后端仓库: <a href="https://github.com/blockscout/blockscout">https://github.com/blockscout/blockscout</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Blockscout </tag>
            
            <tag> Layer2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Layer2 —— OP Stack 部署指南</title>
      <link href="/2025/09/15/op-stack-deployment-part1/"/>
      <url>/2025/09/15/op-stack-deployment-part1/</url>
      
        <content type="html"><![CDATA[<h2 id="一、准备系统环境"><a href="#一、准备系统环境" class="headerlink" title="一、准备系统环境"></a>一、准备系统环境</h2><h3 id="1-1-安装-Ubuntu"><a href="#1-1-安装-Ubuntu" class="headerlink" title="1.1 安装 Ubuntu"></a>1.1 安装 Ubuntu</h3><p>打开 Windows PowerShell 终端</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看可用的 Ubuntu 发行版</span></span><br><span class="line">wsl <span class="literal">--list</span> <span class="literal">--online</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装指定版本的 Ubuntu</span></span><br><span class="line">wsl <span class="literal">--install</span> <span class="literal">-d</span> Ubuntu<span class="literal">-24</span>.<span class="number">04</span></span><br></pre></td></tr></table></figure><h3 id="1-2-安装软件依赖"><a href="#1-2-安装软件依赖" class="headerlink" title="1.2 安装软件依赖"></a>1.2 安装软件依赖</h3><p>打开 Ubuntu-24.04 子系统（在安装 pnpm 和 mise 时，需修改自己环境变量加载的路径）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新系统</span></span><br><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装基础依赖</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y curl wget git build-essential</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 go</span></span><br><span class="line">wget https://go.dev/dl/go1.25.0.linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> tar -C /usr/local -xzf go1.25.0.linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">rm</span> go1.25.0.linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;\n# Go Language\nexport PATH=$PATH:/usr/local/go/bin&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 node.js</span></span><br><span class="line">curl -fsSL https://deb.nodesource.com/setup_22.x | <span class="built_in">sudo</span> -E bash -</span><br><span class="line"><span class="built_in">sudo</span> apt-get install -y nodejs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 pnpm</span></span><br><span class="line">curl -fsSL https://get.pnpm.io/install.sh | sh</span><br><span class="line"><span class="built_in">source</span> /home/eth/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 foundry</span></span><br><span class="line">curl -L https://foundry.paradigm.xyz | bash</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">~/.foundry/bin/foundryup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 make</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y make</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 jq</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y jq</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 direnv</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y direnv</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;\n# Direnv hook\neval &quot;$(direnv hook bash)&quot;&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 just</span></span><br><span class="line">curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y</span><br><span class="line">. <span class="string">&quot;<span class="variable">$HOME</span>/.cargo/env&quot;</span></span><br><span class="line">cargo install just</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 mise</span></span><br><span class="line">curl https://mise.run | sh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;eval \&quot;\$(/home/eth/.local/bin/mise activate bash)\&quot;&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h3 id="1-3-验证安装"><a href="#1-3-验证安装" class="headerlink" title="1.3 验证安装"></a>1.3 验证安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查所需软件依赖是否正确安装</span></span><br><span class="line">git --version<span class="comment"># git version 2.43.0</span></span><br><span class="line">go version        <span class="comment"># go version go1.25.0 linux/amd64</span></span><br><span class="line">node --version <span class="comment"># v22.19.0</span></span><br><span class="line">pnpm --version<span class="comment"># 10.16.1</span></span><br><span class="line">forge --version<span class="comment"># forge Version: 1.3.5-stable</span></span><br><span class="line">make --version<span class="comment"># GNU Make 4.3</span></span><br><span class="line">jq --version<span class="comment"># jq-1.7</span></span><br><span class="line">direnv --version<span class="comment"># 2.32.1</span></span><br><span class="line">rustc --version<span class="comment"># rustc 1.89.0 (29483883e 2025-08-04)</span></span><br><span class="line">just --version<span class="comment"># just 1.42.4</span></span><br><span class="line">mise --version<span class="comment"># 2025.9.10 linux-x64 (2025-09-13)</span></span><br></pre></td></tr></table></figure><h2 id="二、获取-Sepolia-测试网资源"><a href="#二、获取-Sepolia-测试网资源" class="headerlink" title="二、获取 Sepolia 测试网资源"></a>二、获取 Sepolia 测试网资源</h2><h3 id="2-1-获取-Sepolia-RPC-URL"><a href="#2-1-获取-Sepolia-RPC-URL" class="headerlink" title="2.1 获取 Sepolia RPC URL"></a>2.1 获取 Sepolia RPC URL</h3><p>从以下服务之一获取 Sepolia RPC URL:</p><ul><li><a href="https://www.alchemy.com/">Alchemy</a>（推荐）</li><li><a href="https://www.quicknode.com/">QuickNode</a></li><li><a href="https://zan.top/">ZAN</a></li></ul><h3 id="2-2-获取测试-ETH"><a href="#2-2-获取测试-ETH" class="headerlink" title="2.2 获取测试 ETH"></a>2.2 获取测试 ETH</h3><p>在以下链接中获取测试币 SepoliaETH。</p><ul><li><a href="https://console.optimism.io/faucet">Superchain Faucet</a></li><li><a href="https://cloud.google.com/application/web3/faucet/ethereum/sepolia">Google Ethereum Sepolia Faucet</a></li><li><a href="https://www.alchemy.com/faucets/ethereum-sepolia">Alchemy Ethereum Sepolia Faucet</a></li></ul><h2 id="三、构建-OP-Stack-组件"><a href="#三、构建-OP-Stack-组件" class="headerlink" title="三、构建 OP-Stack 组件"></a>三、构建 OP-Stack 组件</h2><h3 id="3-1-克隆-optimism-和-op-geth-仓库"><a href="#3-1-克隆-optimism-和-op-geth-仓库" class="headerlink" title="3.1 克隆 optimism 和 op-geth 仓库"></a>3.1 克隆 optimism 和 op-geth 仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 克隆 optimism 并切换到最新 release 分支</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/ethereum-optimism/optimism.git</span><br><span class="line"><span class="built_in">cd</span> optimism</span><br><span class="line">git checkout v1.13.6 -b v1.13.6</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆 op-geth 到 optimism 目录下并切换到最新 release 分支</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/ethereum-optimism/op-geth.git</span><br><span class="line"><span class="built_in">cd</span> op-geth</span><br><span class="line">git checkout v1.101602.0 -b v1.101602.0</span><br></pre></td></tr></table></figure><h3 id="3-2-构建-op-geth，op-node，op-batcher，op-proposer"><a href="#3-2-构建-op-geth，op-node，op-batcher，op-proposer" class="headerlink" title="3.2 构建 op-geth，op-node，op-batcher，op-proposer"></a>3.2 构建 op-geth，op-node，op-batcher，op-proposer</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/optimism/op-geth</span><br><span class="line">make geth</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">make op-node op-batcher op-proposer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查组件是否构建成功</span></span><br><span class="line">./op-geth/build/bin/geth --version</span><br><span class="line">./op-node/bin/op-node --version</span><br><span class="line">./op-batcher/bin/op-batcher --version</span><br><span class="line">./op-proposer/bin/op-proposer --version</span><br></pre></td></tr></table></figure><h2 id="四、配置环境变量"><a href="#四、配置环境变量" class="headerlink" title="四、配置环境变量"></a>四、配置环境变量</h2><h3 id="4-1-生成账户"><a href="#4-1-生成账户" class="headerlink" title="4.1 生成账户"></a>4.1 生成账户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/optimism</span><br><span class="line">./packages/contracts-bedrock/scripts/getting-started/wallets.sh</span><br></pre></td></tr></table></figure><p>此命令会生成五个地址及其私钥：</p><ul><li><code>Admin</code>（管理员）</li><li><code>Batcher</code>（批处理者）</li><li><code>Proposer</code>（提议者）</li><li><code>Sequencer</code>（排序者）</li><li><code>Challenger</code>（挑战者）</li></ul><h3 id="4-2-编辑环境变量文件"><a href="#4-2-编辑环境变量文件" class="headerlink" title="4.2 编辑环境变量文件"></a>4.2 编辑环境变量文件</h3><p>创建<code>.envrc</code> 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano .envrc</span><br></pre></td></tr></table></figure><p>填写以下变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Admin account</span></span><br><span class="line"><span class="built_in">export</span> GS_ADMIN_ADDRESS=</span><br><span class="line"><span class="built_in">export</span> GS_ADMIN_PRIVATE_KEY=</span><br><span class="line"></span><br><span class="line"><span class="comment"># Batcher account</span></span><br><span class="line"><span class="built_in">export</span> GS_BATCHER_ADDRESS=</span><br><span class="line"><span class="built_in">export</span> GS_BATCHER_PRIVATE_KEY=</span><br><span class="line"></span><br><span class="line"><span class="comment"># Proposer account</span></span><br><span class="line"><span class="built_in">export</span> GS_PROPOSER_ADDRESS=</span><br><span class="line"><span class="built_in">export</span> GS_PROPOSER_PRIVATE_KEY=</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sequencer account</span></span><br><span class="line"><span class="built_in">export</span> GS_SEQUENCER_ADDRESS=</span><br><span class="line"><span class="built_in">export</span> GS_SEQUENCER_PRIVATE_KEY=</span><br><span class="line"></span><br><span class="line"><span class="comment"># Challenger account</span></span><br><span class="line"><span class="built_in">export</span> GS_CHALLENGER_ADDRESS=</span><br><span class="line"><span class="built_in">export</span> GS_CHALLENGER_PRIVATE_KEY=</span><br><span class="line"></span><br><span class="line"><span class="comment">##################################################</span></span><br><span class="line"><span class="comment">#            Layer1 RPC Configuration            #</span></span><br><span class="line"><span class="comment">##################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RPC URL for the L1 network to interact with</span></span><br><span class="line"><span class="built_in">export</span> L1_RPC_URL=</span><br><span class="line"><span class="built_in">export</span> L1_BEACON_URL=<span class="string">&quot;https://ethereum-sepolia-beacon-api.publicnode.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The kind of RPC provider, used to inform optimal transactions receipts</span></span><br><span class="line"><span class="comment"># fetching. Valid options: alchemy, quicknode, infura, parity, nethermind,</span></span><br><span class="line"><span class="comment"># debug_geth, erigon, basic, any.</span></span><br><span class="line"><span class="built_in">export</span> L1_RPC_KIND=</span><br><span class="line"></span><br><span class="line"><span class="comment">##################################################</span></span><br><span class="line"><span class="comment">#               Chain Configuration              #</span></span><br><span class="line"><span class="comment">##################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The unique chain ID of the Layer 1 network(e.g., Sepolia = 11155111)</span></span><br><span class="line"><span class="built_in">export</span> L1_CHAIN_ID=11155111</span><br><span class="line"><span class="comment"># The unique chain ID you assign to your Layer 2 network (custom value)</span></span><br><span class="line"><span class="built_in">export</span> L2_CHAIN_ID=</span><br><span class="line"><span class="comment"># The average block time of the Layer 1 network (in seconds)</span></span><br><span class="line"><span class="built_in">export</span> L1_BLOCK_TIME=12</span><br><span class="line"><span class="comment"># The block time you configure for your Layer 2 network (in seconds)</span></span><br><span class="line"><span class="built_in">export</span> L2_BLOCK_TIME=2</span><br></pre></td></tr></table></figure><p>保存文件(Ctrl+O, Enter, Ctrl+X)</p><h3 id="4-3-加载环境变量"><a href="#4-3-加载环境变量" class="headerlink" title="4.3 加载环境变量"></a>4.3 加载环境变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">direnv allow</span><br></pre></td></tr></table></figure><p>验证环境变量是否加载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== 环境变量检查 ===&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GS_ADMIN_ADDRESS: <span class="variable">$GS_ADMIN_ADDRESS</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GS_BATCHER_ADDRESS: <span class="variable">$GS_BATCHER_ADDRESS</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GS_PROPOSER_ADDRESS: <span class="variable">$GS_PROPOSER_ADDRESS</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GS_SEQUENCER_ADDRESS: <span class="variable">$GS_SEQUENCER_ADDRESS</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;GS_CHALLENGER_ADDRESS: <span class="variable">$GS_CHALLENGER_ADDRESS</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;L1_RPC_KIND: <span class="variable">$L1_RPC_KIND</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;L1_RPC_URL: <span class="variable">$L1_RPC_URL</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;L1_BEACON_URL: <span class="variable">$L1_BEACON_URL</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;L1_CHAIN_ID: <span class="variable">$L1_CHAIN_ID</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;L2_CHAIN_ID: <span class="variable">$L2_CHAIN_ID</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;L1_BLOCK_TIME: <span class="variable">$L1_BLOCK_TIME</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;L2_BLOCK_TIME: <span class="variable">$L2_BLOCK_TIME</span>&quot;</span></span><br></pre></td></tr></table></figure><h3 id="4-4-为账户充值"><a href="#4-4-为账户充值" class="headerlink" title="4.4 为账户充值"></a>4.4 为账户充值</h3><p>为以下地址充值 SepoliaETH：</p><ul><li><code>Admin</code> — 0.5 SepoliaETH</li><li><code>Batcher</code> — 0.1 SepoliaETH</li><li><code>Proposer</code> — 0.2 SepoliaETH</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看账户余额</span></span><br><span class="line">cast balance <span class="variable">$GS_ADMIN_ADDRESS</span> --rpc-url <span class="variable">$L1_RPC_URL</span></span><br><span class="line">cast balance <span class="variable">$GS_BATCHER_ADDRESS</span> --rpc-url <span class="variable">$L1_RPC_URL</span></span><br><span class="line">cast balance <span class="variable">$GS_PROPOSER_ADDRESS</span> --rpc-url <span class="variable">$L1_RPC_URL</span></span><br></pre></td></tr></table></figure><h2 id="五、部署-L1-合约"><a href="#五、部署-L1-合约" class="headerlink" title="五、部署 L1 合约"></a>五、部署 L1 合约</h2><h3 id="5-1-获取-op-deployer"><a href="#5-1-获取-op-deployer" class="headerlink" title="5.1 获取 op-deployer"></a>5.1 获取 op-deployer</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/optimism</span><br><span class="line"><span class="built_in">mkdir</span> -p bin</span><br><span class="line">wget https://github.com/ethereum-optimism/optimism/releases/download/op-deployer%2Fv0.2.6/op-deployer-0.2.6-linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> tar -C ./bin -xzf op-deployer-0.2.6-linux-amd64.tar.gz --strip-components=1</span><br><span class="line"><span class="built_in">rm</span> op-deployer-0.2.6-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证是否下载解压成功</span></span><br><span class="line">./bin/op-deployer --version</span><br></pre></td></tr></table></figure><h3 id="5-2-初始化-op-deployer-配置"><a href="#5-2-初始化-op-deployer-配置" class="headerlink" title="5.2 初始化 op-deployer 配置"></a>5.2 初始化 op-deployer 配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/.deployer</span><br><span class="line">./bin/op-deployer init --l1-chain-id <span class="variable">$L1_CHAIN_ID</span> --l2-chain-ids <span class="variable">$L2_CHAIN_ID</span> --workdir .deployer</span><br></pre></td></tr></table></figure><p>此命令会生成 <code>intend.json</code> 和 <code>state.json</code></p><h3 id="5-3-修改-intend-json-配置"><a href="#5-3-修改-intend-json-配置" class="headerlink" title="5.3 修改 intend.json 配置"></a>5.3 修改 intend.json 配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano .deployer/intent.toml</span><br></pre></td></tr></table></figure><p>确保配置中包含以下内容并替换相应的地址：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">configType = <span class="string">&quot;standard&quot;</span></span><br><span class="line">l1ChainID = 11155111</span><br><span class="line">opcmAddress = <span class="string">&quot;0x6b6f9129efb1b7a48f84e3b787333d1dca02ee34&quot;</span><span class="comment"># L1 上的 OP Chain Manager 合约地址</span></span><br><span class="line">fundDevAccounts = <span class="literal">false</span></span><br><span class="line">useInterop = <span class="literal">false</span></span><br><span class="line">l1ContractsLocator = <span class="string">&quot;tag://op-contracts/v2.2.0&quot;</span></span><br><span class="line">l2ContractsLocator = <span class="string">&quot;tag://op-contracts/v1.7.0-beta.1+l2-contracts&quot;</span></span><br><span class="line"></span><br><span class="line">[[chains]]</span><br><span class="line">  <span class="built_in">id</span> = <span class="string">&quot;0x00000000000000000000000000000000000000000000000000000000004f5da2&quot;</span><span class="comment"># L2_CHAIN_ID 的十六进制</span></span><br><span class="line">  baseFeeVaultRecipient = <span class="string">&quot;YOUR_ADMIN_ADDRESS&quot;</span></span><br><span class="line">  l1FeeVaultRecipient = <span class="string">&quot;YOUR_ADMIN_ADDRESS&quot;</span></span><br><span class="line">  sequencerFeeVaultRecipient = <span class="string">&quot;YOUR_ADMIN_ADDRESS&quot;</span></span><br><span class="line">  eip1559DenominatorCanyon = 250</span><br><span class="line">  eip1559Denominator = 50</span><br><span class="line">  eip1559Elasticity = 6</span><br><span class="line">  [chains.roles]</span><br><span class="line">    l1ProxyAdminOwner = <span class="string">&quot;0x1eb2ffc903729a0f03966b917003800b145f56e2&quot;</span></span><br><span class="line">    l2ProxyAdminOwner = <span class="string">&quot;0x2fc3ffc903729a0f03966b917003800b145f67f3&quot;</span></span><br><span class="line">    systemConfigOwner = <span class="string">&quot;YOUR_ADMIN_ADDRESS&quot;</span></span><br><span class="line">    unsafeBlockSigner = <span class="string">&quot;YOUR_SEQUENCER_ADDRESS&quot;</span></span><br><span class="line">    batcher = <span class="string">&quot;YOUR_BATCHER_ADDRESS&quot;</span></span><br><span class="line">    proposer = <span class="string">&quot;YOUR_PROPOSER_ADDRESS&quot;</span></span><br><span class="line">    challenger = <span class="string">&quot;0xfd1d2e729ae8eee2e146c033bf4400fe75284301&quot;</span></span><br></pre></td></tr></table></figure><h3 id="5-4-部署-L1-合约"><a href="#5-4-部署-L1-合约" class="headerlink" title="5.4 部署 L1 合约"></a>5.4 部署 L1 合约</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询 L1 gas fee，判断 L1 RPC 是否连接成功</span></span><br><span class="line">cast gas-price --rpc-url <span class="variable">$L1_RPC_URL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署合约</span></span><br><span class="line">./bin/op-deployer apply --workdir .deployer --l1-rpc-url <span class="variable">$L1_RPC_URL</span> --private-key <span class="variable">$GS_ADMIN_PRIVATE_KEY</span></span><br></pre></td></tr></table></figure><h3 id="5-5-生成-L2-配置文件"><a href="#5-5-生成-L2-配置文件" class="headerlink" title="5.5 生成 L2 配置文件"></a>5.5 生成 L2 配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成 genesis.json（用于 op-geth）</span></span><br><span class="line">./bin/op-deployer inspect genesis --workdir .deployer <span class="variable">$L2_CHAIN_ID</span> &gt; .deployer/genesis.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成 rollup.json（用于 op-node）</span></span><br><span class="line">./bin/op-deployer inspect rollup --workdir .deployer <span class="variable">$L2_CHAIN_ID</span> &gt; .deployer/rollup.json</span><br></pre></td></tr></table></figure><h2 id="六、启动-Layer2"><a href="#六、启动-Layer2" class="headerlink" title="六、启动 Layer2"></a>六、启动 Layer2</h2><h3 id="6-1-初始化并启动-op-geth"><a href="#6-1-初始化并启动-op-geth" class="headerlink" title="6.1 初始化并启动 op-geth"></a>6.1 初始化并启动 op-geth</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成 jwt 密钥用于 op-geth 与 op-node 通信</span></span><br><span class="line"><span class="built_in">cd</span> ~/optimism/op-geth</span><br><span class="line">openssl rand -hex 32 &gt; jwt.txt</span><br><span class="line"><span class="built_in">cp</span> jwt.txt ../op-node/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 op-geth</span></span><br><span class="line"><span class="built_in">mkdir</span> -p datadir</span><br><span class="line">build/bin/geth init --state.scheme=<span class="built_in">hash</span> --datadir=datadir ../.deployer/genesis.json</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动 op-geth</span></span><br><span class="line">./build/bin/geth \</span><br><span class="line">--datadir ./datadir \</span><br><span class="line">--http \</span><br><span class="line">    --http.corsdomain=<span class="string">&quot;*&quot;</span> \</span><br><span class="line">    --http.vhosts=<span class="string">&quot;*&quot;</span> \</span><br><span class="line">    --http.addr=0.0.0.0 \</span><br><span class="line">    --http.api=web3,debug,eth,txpool,net,engine,miner \</span><br><span class="line">    --ws \</span><br><span class="line">    --ws.addr=0.0.0.0 \</span><br><span class="line">    --ws.port=8546 \</span><br><span class="line">    --ws.origins=<span class="string">&quot;*&quot;</span> \</span><br><span class="line">    --ws.api=debug,eth,txpool,net,engine,miner \</span><br><span class="line">    --syncmode=full \</span><br><span class="line">    --gcmode=archive \</span><br><span class="line">    --nodiscover \</span><br><span class="line">    --maxpeers=0 \</span><br><span class="line">    --networkid=<span class="variable">$L2_CHAIN_ID</span> \</span><br><span class="line">    --authrpc.vhosts=<span class="string">&quot;*&quot;</span> \</span><br><span class="line">    --authrpc.addr=0.0.0.0 \</span><br><span class="line">    --authrpc.port=8551 \</span><br><span class="line">    --authrpc.jwtsecret=./jwt.txt \</span><br><span class="line">    --rollup.disabletxpoolgossip=<span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="6-2-启动-op-node"><a href="#6-2-启动-op-node" class="headerlink" title="6.2 启动 op-node"></a>6.2 启动 op-node</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/optimism/op-node</span><br><span class="line"></span><br><span class="line">./bin/op-node \</span><br><span class="line">--l2=http://localhost:8551 \</span><br><span class="line">--l2.jwt-secret=./jwt.txt \</span><br><span class="line">--sequencer.enabled \</span><br><span class="line">--sequencer.l1-confs=5 \</span><br><span class="line">--verifier.l1-confs=4 \</span><br><span class="line">--rollup.config=../.deployer/rollup.json \</span><br><span class="line">--rpc.addr=0.0.0.0 \</span><br><span class="line">--rpc.port=9545 \</span><br><span class="line">--p2p.disable \</span><br><span class="line">--rpc.enable-admin \</span><br><span class="line">--p2p.sequencer.key=<span class="variable">$GS_SEQUENCER_PRIVATE_KEY</span> \</span><br><span class="line">--l1=<span class="variable">$L1_RPC_URL</span> \</span><br><span class="line">--l1.rpckind=<span class="variable">$L1_RPC_KIND</span> \</span><br><span class="line">--l1.beacon=<span class="variable">$L1_BEACON_URL</span></span><br></pre></td></tr></table></figure><h3 id="6-3-启动-op-batcher"><a href="#6-3-启动-op-batcher" class="headerlink" title="6.3 启动 op-batcher"></a>6.3 启动 op-batcher</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/optimism/op-batcher</span><br><span class="line"></span><br><span class="line">./bin/op-batcher \</span><br><span class="line">--l2-eth-rpc=http://localhost:8545 \</span><br><span class="line">--rollup-rpc=http://localhost:9545 \</span><br><span class="line">--poll-interval=1s \</span><br><span class="line">--sub-safety-margin=6 \</span><br><span class="line">--num-confirmations=1 \</span><br><span class="line">--safe-abort-nonce-too-low-count=3 \</span><br><span class="line">--resubmission-timeout=30s \</span><br><span class="line">--rpc.addr=0.0.0.0 \</span><br><span class="line">--rpc.port=8548 \</span><br><span class="line">--rpc.enable-admin \</span><br><span class="line">--max-channel-duration=25 \</span><br><span class="line">--l1-eth-rpc=<span class="variable">$L1_RPC_URL</span> \</span><br><span class="line">--private-key=<span class="variable">$GS_BATCHER_PRIVATE_KEY</span></span><br></pre></td></tr></table></figure><h3 id="6-4-启动-op-proposer"><a href="#6-4-启动-op-proposer" class="headerlink" title="6.4 启动 op-proposer"></a>6.4 启动 op-proposer</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载 op-proposer 配置变量（也可加到 .envrc 里面）</span></span><br><span class="line"><span class="built_in">export</span> OP_PROPOSER_WAIT_NODE_SYNC=<span class="literal">true</span></span><br><span class="line"><span class="built_in">export</span> OP_PROPOSER_PROPOSAL_INTERVAL=15m</span><br><span class="line"><span class="built_in">export</span> OP_PROPOSER_GAME_FACTORY_ADDRESS=$(<span class="built_in">cat</span> ~/.deployer/state.json | jq -r <span class="string">&#x27;.opChainDeployments[0].disputeGameFactoryProxyAddress&#x27;</span>)</span><br><span class="line"><span class="built_in">export</span> OP_PROPOSER_GAME_TYPE=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/optimism/op-proposer</span><br><span class="line"></span><br><span class="line">./bin/op-proposer \</span><br><span class="line">  --poll-interval=12s \</span><br><span class="line">  --rpc.port=8560 \</span><br><span class="line">  --rollup-rpc=http://localhost:9545 \</span><br><span class="line">  --private-key=<span class="variable">$GS_PROPOSER_PRIVATE_KEY</span> \</span><br><span class="line">  --l1-eth-rpc=<span class="variable">$L1_RPC_URL</span></span><br></pre></td></tr></table></figure><h2 id="七、验证部署"><a href="#七、验证部署" class="headerlink" title="七、验证部署"></a>七、验证部署</h2><h3 id="7-1-检查-L2-链状态"><a href="#7-1-检查-L2-链状态" class="headerlink" title="7.1 检查 L2 链状态"></a>7.1 检查 L2 链状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  --data <span class="string">&#x27;&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;eth_blockNumber&quot;,&quot;params&quot;:[],&quot;id&quot;:1&#125;&#x27;</span> \</span><br><span class="line">  <span class="variable">$L2_RPC_URL</span></span><br></pre></td></tr></table></figure><h3 id="7-2-连接钱包到-Layer2"><a href="#7-2-连接钱包到-Layer2" class="headerlink" title="7.2 连接钱包到 Layer2"></a>7.2 连接钱包到 Layer2</h3><p>在 MetaMask 中添加自定义网络：</p><ul><li>网络名称：OP Stack Rollup</li><li>RPC URL：<a href="http://localhost:8545/">http://localhost:8545</a></li><li>链 ID：L2_CHAIN_ID</li><li>符号：ETH</li></ul><h3 id="7-3-将-SepoliaETH-发送到-Bridge-合约"><a href="#7-3-将-SepoliaETH-发送到-Bridge-合约" class="headerlink" title="7.3 将 SepoliaETH 发送到 Bridge 合约"></a>7.3 将 SepoliaETH 发送到 Bridge 合约</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取 L1StandardBridge 地址</span></span><br><span class="line">L1StandardBridge=$(<span class="built_in">cat</span> ~/optimism/.deployer/state.json | jq -r <span class="string">&#x27;.opChainDeployments[0].l1StandardBridgeProxyAddress&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;L1StandardBridge 地址: <span class="variable">$L1StandardBridge</span>&quot;</span></span><br></pre></td></tr></table></figure><p>通过 Metamask 向你的 <strong>桥接地址</strong> 发送(0.0001 SepoliaETH)，发送成功后大约需要 5 分钟才能在 Layer2 上看到 ETH.</p><h2 id="八、基本转账-CLI-操作实例"><a href="#八、基本转账-CLI-操作实例" class="headerlink" title="八、基本转账 CLI 操作实例"></a>八、基本转账 CLI 操作实例</h2><h3 id="8-1-从-L1-的-Admin-桥接到-L2-的-admin"><a href="#8-1-从-L1-的-Admin-桥接到-L2-的-admin" class="headerlink" title="8.1 从 L1 的 Admin 桥接到 L2 的 admin"></a>8.1 从 L1 的 Admin 桥接到 L2 的 admin</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cast send <span class="variable">$L1StandardBridge</span> \</span><br><span class="line">  --rpc-url <span class="variable">$L1_RPC_URL</span> \</span><br><span class="line">  --private-key <span class="variable">$GS_ADMIN_PRIVATE_KEY</span> \</span><br><span class="line">  --value 0.0001ether \</span><br><span class="line">  <span class="string">&quot;depositETH(uint32,bytes)&quot;</span> \</span><br><span class="line">  200000 \</span><br><span class="line">  <span class="string">&quot;0x&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Admin L1 和 L2 的余额</span></span><br><span class="line">cast balance <span class="variable">$GS_ADMIN_ADDRESS</span> --rpc-url <span class="variable">$L1_RPC_URL</span></span><br><span class="line">cast balance <span class="variable">$GS_ADMIN_ADDRESS</span> --rpc-url <span class="variable">$L2_RPC_URL</span></span><br></pre></td></tr></table></figure><h3 id="8-2-从-L1-的-Admin-桥接到-L2-的-Batcher"><a href="#8-2-从-L1-的-Admin-桥接到-L2-的-Batcher" class="headerlink" title="8.2 从 L1 的 Admin 桥接到 L2 的 Batcher"></a>8.2 从 L1 的 Admin 桥接到 L2 的 Batcher</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cast send <span class="variable">$L1StandardBridge</span> \</span><br><span class="line">  --rpc-url <span class="variable">$L1_RPC_URL</span> \</span><br><span class="line">  --private-key <span class="variable">$GS_ADMIN_PRIVATE_KEY</span> \</span><br><span class="line">  --value 0.0001ether \</span><br><span class="line">  <span class="string">&quot;depositETHTo(address,uint32,bytes)&quot;</span> \</span><br><span class="line">  <span class="variable">$GS_BATCHER_ADDRESS</span> \</span><br><span class="line">  200000 \</span><br><span class="line">  <span class="string">&quot;0x&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Admin L1 和 Batcher L2 的余额</span></span><br><span class="line">cast balance <span class="variable">$GS_ADMIN_ADDRESS</span> --rpc-url <span class="variable">$L1_RPC_URL</span></span><br><span class="line">cast balance <span class="variable">$GS_BATCHER_ADDRESS</span> --rpc-url <span class="variable">$L2_RPC_URL</span></span><br></pre></td></tr></table></figure><h3 id="8-3-L2-转账"><a href="#8-3-L2-转账" class="headerlink" title="8.3 L2 转账"></a>8.3 L2 转账</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># L2 从 Batcher 转账到 Admin</span></span><br><span class="line">cast send <span class="variable">$GS_ADMIN_ADDRESS</span> \</span><br><span class="line">  --rpc-url <span class="variable">$L2_RPC_URL</span> \</span><br><span class="line">  --private-key <span class="variable">$GS_BATCHER_PRIVATE_KEY</span> \</span><br><span class="line">  --value 0.00001ether</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Admin L2 和 Batcher L2 的余额</span></span><br><span class="line">cast balance <span class="variable">$GS_ADMIN_ADDRESS</span> --rpc-url <span class="variable">$L2_RPC_URL</span></span><br><span class="line">cast balance <span class="variable">$GS_BATCHER_ADDRESS</span> --rpc-url <span class="variable">$L2_RPC_URL</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Layer2 </tag>
            
            <tag> OPStack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>慢练勤修，别急放松 | 道家武术馆一月清修</title>
      <link href="/2025/02/22/taichi-28/"/>
      <url>/2025/02/22/taichi-28/</url>
      
        <content type="html"><![CDATA[<p>一月上旬读了三本书 ——《36 万遍感恩的奇迹》、《清醒地活》、《内在工程》，这三本书中都有部分篇幅讲述了阴阳哲学，让我对道家文化产生了浓厚兴趣，再次看到之前觉得平平无奇的太极图的第一反应竟然是 —— <em>It is fascinating</em>，刚好今年也有学习太极和养生的计划，然后就报名了武当山道家传统武术馆的养生班，开启了一个月的清修生活。</p><img src="/images/2025/slow_is_fast.jpg" width="70%" alt="Slow is Fast" style="display: block; margin: 0 auto;"><hr><h2 id="武馆日常"><a href="#武馆日常" class="headerlink" title="武馆日常"></a>武馆日常</h2><ul><li>早上 <strong>6:30</strong> 到练功堂共修五行气功</li><li>上午 <strong>9:00</strong> 和下午 <strong>15:00</strong> 的武术课是教练带同学们一起练习大约一小时的基本功<br>（包含柔韧性、耐力、平衡性、协调性、爆发力的训练。这一部分我超级喜欢，有开心快乐的蹦蹦跳跳环节）</li><li>之后到各自教练的带练区域学习或复习自己的功法</li><li>傍晚 <strong>18:30</strong> 有一个小时的静坐课，教练会带大家做几组静态拉伸然后开启禅修模式</li></ul><p>武馆日常伙食清淡，素食者友好，我感觉在武馆待了一个月体表脂肪都厚了一点点。<br>住宿我选的是舒适单人间，我觉得环境很舒适很方便而且下午的时候我的房间可以晒到大太阳，洒进房间的阳光让人心情舒畅~</p><img src="/images/2025/standing.jpg" width="60%" alt="站桩" style="display: block; margin: 0 auto;"><hr><h2 id="阅读与体悟"><a href="#阅读与体悟" class="headerlink" title="阅读与体悟"></a>阅读与体悟</h2><p>在武馆清修期间阅读了五本书，其中两本和武馆修习很搭特别推荐：</p><ul><li>《The Inner Game of Tennis》（中文版是《身心合一的奇迹力量》，武志红老师推荐）和这本书中提及的《箭术与禅心》</li></ul><p>在平日练功的时候我会让自己的大脑安静下来，让自己的注意力放松，不去过度尝试努力，而是有觉知地卸掉多余紧张的力，相信自己的身体并让其自然流动，并在攻与防的招式转换中体验势的变化。</p><p>在这个过程中好像对“消融的自我”也有了一些体悟：</p><ul><li>太极养我的同时我也在养太极</li><li>我在执剑的时候剑也同时在执我</li><li>消融的自我是客与主的转换，在这一瞬似乎都彼此融合，也就再没有区分的需要了</li></ul><img src="/images/2025/daodejing.jpg" width="70%" alt="Dao De Jing" style="display: block; margin: 0 auto;"><hr><h2 id="休息日体验"><a href="#休息日体验" class="headerlink" title="休息日体验"></a>休息日体验</h2><p>除了武馆的修习之外，休息日和结识的伙伴一起解锁了许多体验：</p><ul><li>除夕日从南岩徒步上金顶抽签，刚好抽到的签和这次清修的初心相关，特别喜欢——阴阳道和<br> （如果抽的签不太满意就再抽，出来玩开心最重要）</li></ul><img src="/images/2025/cat.jpg" width="55%" alt="Cat" style="display: block; margin: 0 auto;"><ul><li>去购买修道风练功服</li><li>去体验道家按摩</li><li>去打卡步行街素食餐厅</li><li>去看《武当一梦》和烟花无人机秀等等</li><li>本周三还参加了武馆汇演，刚好是清修最后一天，就算是毕业典礼了</li></ul><img src="/images/2025/dream_of_wudang.jpg" width="70%" alt="One Dream at Wudang" style="display: block; margin: 0 auto;"><hr><h2 id="感恩与前行"><a href="#感恩与前行" class="headerlink" title="感恩与前行"></a>感恩与前行</h2><p>很感恩，很开心，很幸运能够遇见那么多很好的伙伴。<br>分别之际虽有不舍，但大家表达的更多是感谢和祝福，而我也会带着这份感恩的心念继续往前走走~</p>]]></content>
      
      
      
        <tags>
            
            <tag> Flow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>神圣的静默 | 武夷山东山禅林十日内观</title>
      <link href="/2024/12/12/vipassana/"/>
      <url>/2024/12/12/vipassana/</url>
      
        <content type="html"><![CDATA[<p>在山上度过了十天禁言、与外界信息隔离的出家生活，从观呼吸开始以慈悲观结束。去之前从没想过内观禅修那么难，难在深入敏锐地专注，难在全然平等地接受。</p><hr><h2 id="关于做"><a href="#关于做" class="headerlink" title="关于做"></a>关于做</h2><p><strong>‘The doers are the major thinkers’</strong> ——这是禅修期间每天都会反反复复浮现在脑海中的一句话，然后在第十天的时候脑海浮现了一个中文翻译，感觉还挺贴切——</p><p><strong>“那些真正付出行动去实践他所思所想的人才是真正的思想家”</strong></p><p>现在回想以前很多时候大概是知道该怎么做的，但是由于内心不够强大，在意他人看法，对确定性的过度偏好再加上周围遇到的人事物，经常陷入自我怀疑和自我否定的状态，这种状态反反复复，消耗了本就不多的心力，淹没了本就微弱的心声，导致无法行动。</p><p>可是当我从广泛的阅读中越来越多地感受到，无论是像苏格拉底、庄子、尼采、黑塞这样的智慧先哲，还是像佛陀、克里希那穆提、葛印卡、萨古茹这样的无私古茹，亦或是像芒格、乔布斯、段永平、纳瓦尔这样的当代名人等等，这些自己内心所尊敬的灵魂或榜样在一生中大部分时间都在践行那些基本的价值观和准则。</p><p>当感受到这点后，自己这颗惶恐不安、迷茫无措、心猿意马的心也慢慢变得更平稳、更清晰、更坚定，向前踏出的脚步也多了几分笃定。</p><p>而当我不再仅仅满足于知识上的理解，而是更多地专注于经验上的理解时，根本性的改变也随之自然而然地发生。</p><hr><h2 id="关于真"><a href="#关于真" class="headerlink" title="关于真"></a>关于真</h2><p>今年的某天我突然意识到我和父母和谐的关系存在泡沫之中，这种虚假的和谐是以无意识地接受那些习以为常的违背自身感受的隐性要求为代价。</p><p>这种长期无意识地接受，这种假只会产生无尽的无意识的否定、扭曲、压抑、控制，这种假永远不会带来真正的了解、真正的尊重、真正的关心、真正的责任。</p><p><strong>假无法带来真正的爱，而真正的爱不会带来伤害。</strong></p><p>当意识到这点后，那些曾经以为已经修复的原生家庭创伤又开始频繁地让我陷入愤怒或悲伤式的情绪闪回，时常让我暴躁不安。</p><p>但这次我决定接受这份创伤就是我的一部分这个事实，不再去否定、合理化、压抑或是试图去原谅，只是全然平等地接受，我决心拥抱完整的自己。</p><p>于是我用内观这把手术刀更深地剖析自己的内心，没有恐惧，没有犹豫。因为我很幸运，我找到了心底那处一直缺失的力量。</p><p>当愤怒像熔岩般喷薄而出时，自我保护和自我支持的意愿便会更加强烈；当悲伤像海浪般呼啸而来时，自我同情和自我关怀的心意便会愈发柔软；当愤怒与悲伤彼此碰撞消融，爱就再次开始流动。</p><hr><h2 id="关于自我"><a href="#关于自我" class="headerlink" title="关于自我"></a>关于自我</h2><p>之前一直有听到说我们这一代比较自我，不健康的自我。可是在意尊重自己的感受真的是一种错误吗？</p><p>当我在学习爱自己的道路上越往前走，我越能深刻理解爱的四要素：</p><ul><li><strong>了解</strong></li><li><strong>尊重</strong></li><li><strong>关心</strong></li><li><strong>责任</strong></li></ul><p>都同等重要并相辅相成。</p><p>如果不能尊重自己的感受，则会产生对自己的否定和压抑，而被压抑的感受则会进入潜意识深层难以根除。</p><p>但是后来我突然明白，那些动机是要求别人违背自己感受以满足自己需求，或是只想周围都围着自己转的人，才是不健康的自我，或是说我执。</p><p>健康的自我需要修炼平等心，如果内心有过多的贪爱，必然会有过多的嗔恨，便会带来我执的痛苦。</p><p>而只有健康的自我或是消融的自我，才更有可能发展出创造性倾向的能力。</p><hr><h2 id="关于变化"><a href="#关于变化" class="headerlink" title="关于变化"></a>关于变化</h2><p>此处引用今年阅读《芒格之道》时直接刻在我心底的一句话——</p><p><strong>“变化总在发生，不去主动迎接进步的变化，就会等到退步的变化。”</strong></p><p>无常，无常，无常，既然不确定性是常态，那就与不确定性共舞，继续往前走走~</p><hr><p>培养觉知，练习感恩<br>持续精进，坚定决心！</p><p><img src="/images/2024/vipassana.jpg"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Flow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>25 Today, Halfway to 50 🤭</title>
      <link href="/2024/01/15/happy-birthday/"/>
      <url>/2024/01/15/happy-birthday/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/2024/happy_birthday.jpg"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Flow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Dialogue with Myself</title>
      <link href="/2023/12/31/2023/"/>
      <url>/2023/12/31/2023/</url>
      
        <content type="html"><![CDATA[<div align="center"><p><strong>2023 年的每一个月、每一周都有一点点不一样</strong><br>某一天，我做了一个小小的改变，从那之后，<strong>每一天</strong>也随之焕然一新<br>因为在喜欢我的人里，多了一位很重要的人 —— <strong>我自己</strong></p><p><em>Just a little change can make all the difference.</em></p><hr><p>当我决定喜欢我自己<br>我开始记录下我每天做得不错的地方<br>以及那些让我开心的事情</p><p>某一天，在日常记录中，我恍然大悟 ——<br>噢，原来这就是 <strong>「具体」</strong></p><hr><p>当内耗与模糊渐渐消散<br>当我开始拥抱所有的感受<br>当我的状态变得越来越好时<br>某一天，我突然明白了《当我开始真正爱自己》这首诗中<br>“<strong>「真正」</strong>”这一词的含义</p><p>那一刻，我知道自己也真正<br>习得了喜欢与爱的能力<br>当然现在还不够有力<br>仍在积蓄力量中~</p><hr><h3 id="✨-My-Vision-for-2024"><a href="#✨-My-Vision-for-2024" class="headerlink" title="✨ My Vision for 2024"></a>✨ My Vision for 2024</h3><p><strong>继续践行长期主义</strong><br><strong>每过完一天，要努力比早上醒来时更聪明一点点</strong><br><strong>培养理性 · 保持好奇 · 珍惜日常</strong> 🌻</p><img src="/images/2023/hello_2024.jpg" width="85%" alt="hello, 2024"></div>]]></content>
      
      
      
        <tags>
            
            <tag> Flow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fortunate to Cross Paths</title>
      <link href="/2023/12/17/fortunate_to_cross_paths/"/>
      <url>/2023/12/17/fortunate_to_cross_paths/</url>
      
        <content type="html"><![CDATA[<div align="center"><p>原来每段相遇都有一份恩情<br>回望今年走过的路，徒过的步<br>不知不觉大家已经认识这么久了<br>感谢相遇，感谢一路同行 🔆</p></div><img src="/images/2023/companions.jpg" width="85%" alt="companions">]]></content>
      
      
      
        <tags>
            
            <tag> Flow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>于人来人往中，不惧离索</title>
      <link href="/2022/12/31/2022/"/>
      <url>/2022/12/31/2022/</url>
      
        <content type="html"><![CDATA[<p>生命是一个淡淡的悲伤的过程，我们要不断地和过去告别，和很多事物告别</p><p>既然现实就是为了分别而相遇，那希望在今后的日子里，能够勇敢去爱，在所有的相遇中不断朝着＂最佳分别＂而努力，直到生命的最后一天</p><p>也希望未来的自己，内心能如水一般，变得更柔软、更包容、更平静~</p>]]></content>
      
      
      
        <tags>
            
            <tag> Flow </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
